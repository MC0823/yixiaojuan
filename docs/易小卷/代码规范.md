# æ˜“å°å· - ä»£ç è§„èŒƒ

> æœ¬æ–‡æ¡£å®šä¹‰äº†æ˜“å°å·é¡¹ç›®çš„ä»£ç ç¼–å†™è§„èŒƒï¼ŒåŸºäº4Wè§„èŒƒçš„ä¸“é¡¹çº¦æŸ

---

## ä¸€ã€æ ¸å¿ƒåŸåˆ™

é¡¹ç›®æ‰€æœ‰ä»£ç å¿…é¡»éµå¾ªä»¥ä¸‹æ ¸å¿ƒåŸåˆ™ï¼š

1. **å•ä¸€èŒè´£** - æ¯ä¸ªç±»/å‡½æ•°/ç»„ä»¶åªè´Ÿè´£ä¸€é¡¹èŒè´£
2. **æœ€å°çŸ¥è¯†** - å°½é‡å‡å°‘æ¨¡å—é—´çš„è€¦åˆåº¦
3. **ä¾èµ–å€’ç½®** - ä¾èµ–æ¥å£è€Œéå…·ä½“å®ç°
4. **ç¦æ­¢æ±¡æŸ“** - ç¦æ­¢å…¨å±€å˜é‡ã€å…¨å±€å‡½æ•°ã€å…¨å±€çŠ¶æ€

---

## äºŒã€åˆ†å±‚æ¶æ„è§„èŒƒ

### 2.1 ä¸‰å±‚æ¶æ„åˆ’åˆ†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    UI å±‚ (Components)           â”‚ â† Reactç»„ä»¶ã€é¡µé¢
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä¸šåŠ¡å±‚ (Services/Stores)       â”‚ â† ä¸šåŠ¡é€»è¾‘ã€çŠ¶æ€ç®¡ç†
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ•°æ®å±‚ (IPC/Database)          â”‚ â† Mainè¿›ç¨‹æœåŠ¡ã€æ•°æ®åº“
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç¦æ­¢è§„åˆ™ï¼š**
- âŒ ç¦æ­¢UIå±‚ç›´æ¥è®¿é—®æ•°æ®åº“
- âŒ ç¦æ­¢æ•°æ®å±‚è®¿é—®UIç»„ä»¶
- âŒ ç¦æ­¢è·¨å±‚ç›´æ¥è°ƒç”¨ï¼ˆå¿…é¡»é€šè¿‡IPCæˆ–Serviceï¼‰

**æ­£ç¡®åšæ³•ï¼š**
```typescript
// âœ… æ­£ç¡®ï¼šUIå±‚é€šè¿‡Serviceè°ƒç”¨ä¸šåŠ¡å±‚
const [courseware, setCourseware] = useState(null);

useEffect(() => {
  coursewareService.fetch(id).then(setCourseware);
}, [id]);

// âŒ é”™è¯¯ï¼šUIå±‚ç›´æ¥è°ƒç”¨IPC
useEffect(() => {
  window.electronAPI.database.query(...);  // ç¦æ­¢
}, []);
```

---

## ä¸‰ã€Electronè¿›ç¨‹é€šä¿¡è§„èŒƒ

### 3.1 IPCå‘½åçº¦å®š

æ‰€æœ‰IPCé€šé“å¿…é¡»éµå¾ª `æ¨¡å—:æ“ä½œ` çš„å‘½åè§„èŒƒï¼š

```typescript
// âœ… æ­£ç¡®çš„IPCé€šé“åç§°
'activation:verify'      // æ¿€æ´»éªŒè¯
'database:courseware:create'  // åˆ›å»ºè¯¾ä»¶
'file:select'            // é€‰æ‹©æ–‡ä»¶
'sync:upload'            // ä¸Šä¼ åŒæ­¥

// âŒ ç¦æ­¢ä½¿ç”¨
'verify'                 // å‘½åä¸æ¸…æ™°
'dbQuery'                // é©¼å³°å¼ï¼Œåº”ä½¿ç”¨å†’å·åˆ†éš”
```

### 3.2 IPCè¯·æ±‚/å“åº”æ ¼å¼

**ç»Ÿä¸€çš„å“åº”ç»“æ„ï¼š**

```typescript
interface IpcResponse<T = any> {
  success: boolean;
  code: string;        // é”™è¯¯ä»£ç 
  message: string;     // ç”¨æˆ·æç¤ºæ¶ˆæ¯
  data?: T;            // å“åº”æ•°æ®
}

// ä½¿ç”¨ç¤ºä¾‹
ipcMain.handle('activation:verify', async (event, code) => {
  try {
    const result = await activationService.verify(code);
    return {
      success: true,
      code: 'OK',
      message: 'æ¿€æ´»æˆåŠŸ',
      data: result
    };
  } catch (error) {
    return {
      success: false,
      code: error.code || 'ERROR',
      message: error.message || 'æ¿€æ´»å¤±è´¥'
    };
  }
});
```

---

## å››ã€çŠ¶æ€ç®¡ç†è§„èŒƒï¼ˆZustandï¼‰

### 4.1 Storeè®¾è®¡åŸåˆ™

**æ¯ä¸ªStoreå¿…é¡»ï¼š**
1. æœ‰æ˜ç¡®çš„èŒè´£è¾¹ç•Œ
2. åŒ…å«åˆå§‹çŠ¶æ€å®šä¹‰
3. åŒ…å«å®Œæ•´çš„ç±»å‹å®šä¹‰
4. ä½¿ç”¨æŒä¹…åŒ–ä¸­é—´ä»¶

**Storeä¸åº”è¯¥ï¼š**
- âŒ æ··åˆå¤šä¸ªä¸šåŠ¡åŸŸçš„çŠ¶æ€
- âŒ åŒ…å«å¼‚æ­¥ä¸šåŠ¡é€»è¾‘ï¼ˆåº”æ”¾åœ¨Serviceä¸­ï¼‰
- âŒ ç›´æ¥è°ƒç”¨IPCï¼ˆåº”é€šè¿‡Serviceé—´æ¥è°ƒç”¨ï¼‰

### 4.2 Storeç¤ºä¾‹

```typescript
import { create } from 'zustand';
import { persist } from 'zustand/middleware';

interface CoursewareState {
  // çŠ¶æ€
  list: Courseware[];
  current: Courseware | null;
  loading: boolean;
  
  // åŠ¨ä½œ
  setCoursewareList: (list: Courseware[]) => void;
  setCurrentCourseware: (courseware: Courseware) => void;
  setLoading: (loading: boolean) => void;
  
  // ä¸è¦ï¼šå¼‚æ­¥æ“ä½œä¸åœ¨Storeä¸­
  // fetchList: async () => { ... }  // âŒ é”™è¯¯
}

export const useCoursewareStore = create<CoursewareState>()(
  persist(
    (set) => ({
      list: [],
      current: null,
      loading: false,
      
      setCoursewareList: (list) => set({ list }),
      setCurrentCourseware: (courseware) => set({ current: courseware }),
      setLoading: (loading) => set({ loading }),
    }),
    {
      name: 'courseware-store',  // localStorageé”®å
      version: 1,
    }
  )
);
```

### 4.3 Serviceä¸­çš„å¼‚æ­¥æ“ä½œ

```typescript
// âœ… æ­£ç¡®ï¼šServiceå¤„ç†å¼‚æ­¥é€»è¾‘
class CoursewareService {
  async fetchList(userId: string) {
    const response = await window.electronAPI.database.courseware.list(userId);
    if (response.success) {
      useCoursewareStore.setState({ list: response.data });
      return response.data;
    }
    throw new Error(response.message);
  }
}
```

---

## äº”ã€ç»„ä»¶è®¾è®¡è§„èŒƒ

### 5.1 ç»„ä»¶èŒè´£çº¦æŸ

**UIç»„ä»¶åº”è¯¥ï¼š**
- ä¸“æ³¨äºæ¸²æŸ“UI
- é€šè¿‡Propsæ¥æ”¶æ•°æ®
- é€šè¿‡å›è°ƒå‡½æ•°å‘çˆ¶ç»„ä»¶ä¼ é€’äº‹ä»¶
- ä½¿ç”¨è‡ªå®šä¹‰Hookå¤ç”¨é€»è¾‘

**UIç»„ä»¶ä¸åº”è¯¥ï¼š**
- âŒ ç›´æ¥è°ƒç”¨IPC
- âŒ ç›´æ¥è®¿é—®Storeä¿®æ”¹çŠ¶æ€
- âŒ åŒ…å«å¤æ‚çš„ä¸šåŠ¡é€»è¾‘
- âŒ æ··åˆå¤šä¸ªä¸šåŠ¡é¢†åŸŸ

### 5.2 ç»„ä»¶ç¤ºä¾‹

```typescript
// âœ… æ­£ç¡®çš„ç»„ä»¶è®¾è®¡
interface CoursewareCardProps {
  courseware: Courseware;
  onOpen: (id: string) => void;
  onDelete: (id: string) => void;
}

export const CoursewareCard: React.FC<CoursewareCardProps> = ({
  courseware,
  onOpen,
  onDelete,
}) => {
  return (
    <Card>
      <div>{courseware.name}</div>
      <button onClick={() => onOpen(courseware.id)}>æ‰“å¼€</button>
      <button onClick={() => onDelete(courseware.id)}>åˆ é™¤</button>
    </Card>
  );
};

// âŒ é”™è¯¯çš„ç»„ä»¶è®¾è®¡
export const CoursewareCard: React.FC<{ coursewareId: string }> = ({
  coursewareId,
}) => {
  const [data, setData] = useState(null);
  
  // ç›´æ¥è°ƒç”¨IPC - ç¦æ­¢ï¼
  useEffect(() => {
    window.electronAPI.database.courseware.get(coursewareId)
      .then(setData);
  }, [coursewareId]);
  
  const handleDelete = async () => {
    // ç›´æ¥ä¿®æ”¹Store - ç¦æ­¢ï¼
    useCoursewareStore.setState({ 
      list: list.filter(c => c.id !== coursewareId)
    });
  };
  
  return <div>...</div>;
};
```

---

## å…­ã€æ ·å¼éš”ç¦»è§„èŒƒ

### 6.1 CSS Moduleså¼ºåˆ¶ä½¿ç”¨

**æ‰€æœ‰æ ·å¼å¿…é¡»ä½¿ç”¨CSS Moduleséš”ç¦»ï¼š**

```typescript
// âœ… æ­£ç¡®
import styles from './CoursewareCard.module.less';

export const CoursewareCard = () => (
  <div className={styles.card}>
    <div className={styles.title}>è¯¾ä»¶æ ‡é¢˜</div>
  </div>
);

// âŒ é”™è¯¯ï¼šå…¨å±€æ ·å¼æ±¡æŸ“
<div className="card" style={{ color: 'red' }}>...</div>
```

### 6.2 æ ·å¼å‘½åè§„èŒƒ

ä½¿ç”¨BEMï¼ˆBlock-Element-Modifierï¼‰è§„èŒƒï¼š

```less
// CoursewareCard.module.less
.card {
  border: 1px solid #ddd;
  border-radius: 8px;
  
  // å…ƒç´ 
  &__header {
    padding: 16px;
    border-bottom: 1px solid #f0f0f0;
  }
  
  &__title {
    font-weight: bold;
    color: #333;
  }
  
  // ä¿®é¥°ç¬¦
  &--active {
    border-color: #87bd76;
    background: #f5f9f3;
  }
}
```

---

## ä¸ƒã€å¼¹çª—çŠ¶æ€ç®¡ç†è§„èŒƒ

### 7.1 ç¦æ­¢åˆ†æ•£ç®¡ç†å¼¹çª—çŠ¶æ€

**âŒ é”™è¯¯åšæ³•ï¼š**
```typescript
// CoursewareList.tsx
const [deleteModalVisible, setDeleteModalVisible] = useState(false);

// DeleteModal.tsx
const [confirmModalVisible, setConfirmModalVisible] = useState(false);

// å¯¼è‡´å¼¹çª—çŠ¶æ€ç®¡ç†æ··ä¹±ï¼Œéš¾ä»¥æ§åˆ¶ï¼
```

**âœ… æ­£ç¡®åšæ³•ï¼š**
```typescript
// modalStore.ts
interface ModalState {
  modals: Record<string, boolean>;
  openModal: (modalId: string) => void;
  closeModal: (modalId: string) => void;
  closeAllModals: () => void;
}

export const useModalStore = create<ModalState>((set) => ({
  modals: {},
  
  openModal: (modalId) =>
    set((state) => ({
      modals: { ...state.modals, [modalId]: true }
    })),
    
  closeModal: (modalId) =>
    set((state) => ({
      modals: { ...state.modals, [modalId]: false }
    })),
    
  closeAllModals: () => set({ modals: {} }),
}));

// ä½¿ç”¨ç¤ºä¾‹
const { openModal, closeModal, modals } = useModalStore();

<button onClick={() => openModal('delete-confirm')}>åˆ é™¤</button>

{modals['delete-confirm'] && (
  <DeleteConfirmModal onConfirm={() => { ... ; closeModal('delete-confirm'); }} />
)}
```

---

## å…«ã€é”™è¯¯å¤„ç†è§„èŒƒ

### 8.1 ç»Ÿä¸€çš„é”™è¯¯å¤„ç†

**åˆ›å»ºé”™è¯¯ç±»ï¼š**

```typescript
// utils/errorHandler.ts
export class AppError extends Error {
  constructor(
    message: string,
    public code: string,
    public userMessage: string,
  ) {
    super(message);
    this.name = 'AppError';
  }
}

export class NetworkError extends AppError {
  constructor(message: string) {
    super(message, 'NETWORK_ERROR', 'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·é‡è¯•');
  }
}

export class OcrError extends AppError {
  constructor(message: string) {
    super(message, 'OCR_ERROR', 'OCRè¯†åˆ«å¤±è´¥ï¼Œè¯·é‡æ–°ä¸Šä¼ ');
  }
}
```

### 8.2 é”™è¯¯ä½¿ç”¨ç¤ºä¾‹

```typescript
async function recognizeImage(imageFile: File) {
  try {
    if (!imageFile) {
      throw new AppError('æœªé€‰æ‹©å›¾ç‰‡', 'NO_IMAGE', 'è¯·é€‰æ‹©è¦è¯†åˆ«çš„å›¾ç‰‡');
    }
    
    const result = await ocrService.recognize(imageFile);
    return result;
    
  } catch (error) {
    if (error instanceof AppError) {
      message.error(error.userMessage);
      console.error(`[${error.code}]`, error.message);
    } else {
      message.error('å‘ç”ŸæœªçŸ¥é”™è¯¯');
      console.error('Unknown error:', error);
    }
    throw error;
  }
}
```

---

## ä¹ã€å‘½åè§„èŒƒ

### 9.1 æ–‡ä»¶/æ–‡ä»¶å¤¹å‘½å

```
src/
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ HomePage.tsx           # Reactç»„ä»¶ï¼šPascalCase
â”‚   â”œâ”€â”€ EditorPage.tsx
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ CoursewareCard.tsx
â”‚   â”œâ”€â”€ CoursewareCard.module.less
â”‚
â”œâ”€â”€ stores/
â”‚   â”œâ”€â”€ coursewareStore.ts      # Storeï¼šcamelCase
â”‚   â”œâ”€â”€ userStore.ts
â”‚
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ coursewareService.ts    # Serviceï¼šcamelCase
â”‚   â”œâ”€â”€ ocrService.ts
â”‚
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ errorHandler.ts         # å·¥å…·ï¼šcamelCase
â”‚   â”œâ”€â”€ validators.ts
â”‚
â””â”€â”€ types/
    â””â”€â”€ index.ts                # ç±»å‹å®šä¹‰
```

### 9.2 å˜é‡/å‡½æ•°å‘½å

```typescript
// âœ… æ­£ç¡®
const coursewareList = [];           // å˜é‡ï¼šcamelCase
const handleDeleteCourseware = () => {}; // äº‹ä»¶å¤„ç†ï¼šhandleXxx
const getCoursewareById = (id) => {}; // å‡½æ•°ï¼šåŠ¨è¯å¼€å¤´

const [loading, setLoading] = useState(false);  // HookçŠ¶æ€

// âŒ ç¦æ­¢
const CoursewareList = [];           // å˜é‡ä¸ç”¨PascalCase
const delete_courseware = () => {};  // ç¦æ­¢snake_case
const courseware_id = 1;             // ç¦æ­¢snake_case
```

---

## åã€ä»£ç å®¡æŸ¥æ¸…å•

å®ŒæˆåŠŸèƒ½å¼€å‘åï¼Œè¯·å¯¹ç…§ä»¥ä¸‹æ¸…å•è‡ªæ£€ï¼š

- [ ] éµå¾ªåˆ†å±‚æ¶æ„ï¼Œæ²¡æœ‰è·¨å±‚ç›´æ¥è°ƒç”¨
- [ ] æ‰€æœ‰IPCè°ƒç”¨éƒ½é€šè¿‡Serviceå°è£…
- [ ] çŠ¶æ€ç®¡ç†ä½¿ç”¨Zustandï¼Œæ²¡æœ‰å…¨å±€å˜é‡
- [ ] å¼¹çª—çŠ¶æ€é›†ä¸­åœ¨modalStoreç®¡ç†
- [ ] æ ·å¼ä½¿ç”¨CSS Moduleséš”ç¦»ï¼Œæ²¡æœ‰å…¨å±€æ ·å¼æ±¡æŸ“
- [ ] ç»„ä»¶èŒè´£å•ä¸€ï¼Œé€»è¾‘å¤æ‚åº¦åˆç†
- [ ] é”™è¯¯å¤„ç†å®Œæ•´ï¼Œæç¤ºä¿¡æ¯å‹å¥½
- [ ] å‘½åè§„èŒƒï¼Œæ˜“äºç†è§£
- [ ] æ²¡æœ‰console.logè°ƒè¯•ä»£ç 
- [ ] TypeScriptç±»å‹å®Œæ•´ï¼Œæ²¡æœ‰anyç±»å‹

---

> ğŸ“ åˆ›å»ºæ—¥æœŸï¼š2025-12-09
> ğŸ”— å…³è”è§„èŒƒï¼š4Wä»£ç è€¦åˆè§„èŒƒ
> ğŸ“– ç›¸å…³æ–‡æ¡£ï¼šDESIGN_æ˜“å°å·.md
